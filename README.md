# Spring 2024 UMass COMPSCI 696DS Homework 1
Getting familiar with the shared Unity cluster is the first step to your project success and 
critical to avoiding improper usages that many interfere with other cluster users.

Please carefully read the following instructions and the linked documentation webpages. Happy 696DS!

## Setup
1. Connect to the Unity GPU cluster: https://docs.unity.rc.umass.edu/documentation/connecting/ssh/.
2. Change to your home directory: `cd ~`. 
This directory, `/home/<username>`, is on a slow HDD and should have 50GB of space. 
It is sufficient for this assignment. 
For your project, we will provide separate guidelines about using workspaces on a fast SSD.
3. Clone this repository and enter it:
    ```
    git clone https://github.com/dhruvdcoder/696ds-unity-assignment.git
    cd 696ds-unity-assignment
    ```
4. Use conda to create an environment for installing relevant packages and libraries for each project. 
Unity already has conda installed and you can load it by `module load miniconda/22.11.1-1`. 
    More about conda can be read here: https://docs.unity.rc.umass.edu/documentation/software/conda/.
5. Create a conda environment for this assignment: 
`conda create --name 696hw1 python=3.9.7 pip`. 
You can replace `696hw1` by your preferred environment name.
6. Activate the conda environment: `conda activate 696hw1`.
7. Install packages in this environment: `pip install -r requirements.txt`.

## Unity job management
- Unity consists of login nodes and computation nodes and uses "slurm" to manage GPU allocation and job scheduling. 
  - Always run jobs (model training, testing, etc.) on computation nodes. 
  **Never run a job on a login node!!! This may prevent others from even logging in.**
- There are in general two ways to access GPUs. 
  - (1) Request an interactive session with GPU access. 
  You will be sent to a computation node and able to run bash and python scripts. 
  Once you close your terminal, the GPU access is lost. This is suitable for debugging. 
  - (2) Submit sbatch jobs to run in the background. 
  Even if you close your terminal, the job will continue to finish. 
  This is suitable for submitting multiple training or evaluation runs that will last for some time.
- Please read more details here: https://docs.unity.rc.umass.edu/documentation/jobs/. 
The linked webpage also has sub-pages.

## Exercise
1. Obtain an interactive session with GPU access and run:
    ```
    srun --pty --partition gypsum-titanx --gres=gpu:1 -c 2 --mem=50GB -t 0-01:00:00 /bin/bash
    
    module load miniconda/22.11.1-1
    conda activate 696hw1
    python test/generate_id.py
    ``` 
Note down the 5 character unique ID generated.
2. Submit `test/generate_id.py` as an `sbatch` job to be run in the background. You may use `sbatch generate_id.sh` to do so. 
Note down the 5 character unique ID generated by this job in the log file `generate_id-<job_ID>.out`. 
3. Paste the two unique IDs in the assignment on Gradescope.
4. You can add commands into `~/.bashrc` so that they will be automatically run when you ssh into a node on Unity.
    ```
    vim ~/.bashrc
    
    # Add this line to avoid manually loading conda
    module load miniconda/22.11.1-1
   
    # Add this line to avoid typing a long name
    # Instead of cd ~/696ds-unity-assignment, 
    # you can now just type cd $hw1
    export hw1=~/696ds-unity-assignment
    ```